var nexttask;function updateClock(){var t=moment(),s=6*t.seconds(),e=6*t.minutes()+s/60,o=t.hours()%12/12*360+90+e/12;if($("#clock-hour").css("transform","rotate("+o+"deg)"),$("#clock-minute").css("transform","rotate("+e+"deg)"),$("#clock-second").css("transform","rotate("+s+"deg)"),$("#digital-hour").text(("0"+t.hours()).slice(-2)),$("#digital-minute").text(("0"+t.minutes()).slice(-2)),$("#digital-second").text(("0"+t.seconds()).slice(-2)),void 0!==nexttask&&((0==t.seconds()||nexttask.start-t<6e4)&&minUpdate(),t>=nexttask.start)){if("Notification"in window){var n="Start "+nexttask.title;try{new Notification("What Work When",{body:n,icon:"apple-touch-icon.png"}),window.navigator.vibrate(500)}catch(t){alert(n)}}location.reload()}}function minUpdate(){$("#info").text("Starts in "+nexttask.start.fromNow(!0))}function secUpdate(){updateClock(),setTimeout(secUpdate,1e3)}function requestPermission(){!1 in window?console.log("Local Notifications not supported!"):Notification.requestPermission(function(){console.info("Local Notifications "+Notification.permission)})}$.ajax({async:!1,url:"schedule.json",dataType:"json",success:function(d){var l=d.day.end,u="";$.each(d.tasks,function(t,s){if(!/\d{4}/.test(s.start))return console.error("Task "+t+' can only be 4 digits. "'+s.start+'" is not allowed'),!1;if(parseInt(s.start)<0||2400<parseInt(s.start))return console.error("Task "+t+' is not a valid 24 hour time. "'+s.start+'" is not allowed'),!1;$("#instructions").remove();var e=s.start,o=e.split(/(\d{2})/),n=moment().hour(o[1]).minute(o[3]).second(0),i=l;d.tasks[t+1]&&(i=d.tasks[t+1].start);var a=i.split(/(\d{2})/),r=moment().hour(a[1]).minute(a[3]);u=moment().isBetween(n,r)?"now":"now"==u?"soon":"";var c=$("#tasks li").first().clone();c.find(".name").text(s.title),c.find(".stime").text(e),c.find(".etime").text(i),c.addClass(u).appendTo("#tasks ol"),"soon"==u&&((nexttask=s).start=n,$("#tasks li").last().append('<span id="info">Starts in '+nexttask.start.fromNow(!0)+"</span>"))}),$("#tasks li").first().remove(),secUpdate()}}),requestPermission();